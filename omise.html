<!DOCTYPE html>
<html lang="ko" class=""> <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ë³¸ ë§›ì§‘ ë¦¬ìŠ¤íŠ¸</title>
    
    <script>
      tailwind.config = {
        darkMode: 'class',
      }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

    <style>
        body { 
            font-family: 'Pretendard', sans-serif; 
            transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c5c5c5; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #a3a3a3; }
        
        html.dark .custom-scrollbar::-webkit-scrollbar-track { background: #374151; }
        html.dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #6b7280; }
        html.dark .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #9ca3af; }

        select {
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1em; padding-right: 2.5rem;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="%23374151" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
        }
        html.dark select {
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="%23d1d5db" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
        }
        .region-card, #theme-toggle { transition: all 0.3s ease-in-out; }
    </style>
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
    </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200">

    <div class="container mx-auto p-4 max-w-4xl">
        <header class="text-center mb-6 relative">
            <a href="#" onclick="location.reload(); return false;" class="inline-block">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white dark:text-red-500">ì¼ë³¸ ë§›ì§‘ ë¦¬ìŠ¤íŠ¸</h1>
            </a>
            <p class="mt-2 text-md text-gray-600 dark:text-gray-400">ì›í•˜ëŠ” ì§€ì—­ì„ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ê²€ìƒ‰í•´ë³´ì„¸ìš”.<br>AI ê¸°ë°˜ ë°ì´í„°ë¡œ, ë¶€ì •í™•í•œ ì •ë³´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <button id="theme-toggle" class="absolute top-0 right-0 p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 dark:focus:ring-offset-gray-900">
                </button>
        </header>
        
        <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-md mb-6 space-y-4">
            <div>
                <label for="food-type-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">1. ìŒì‹ ì¢…ë¥˜ ì„ íƒ</label>
                <select id="food-type-select" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 transition cursor-pointer bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-50">
                    <option value="all">-- ì „ì²´ --</option>
                    <optgroup label="ğŸœ ë©´ë¥˜">
                        <option value="ramen">ë¼ë©˜</option>
                        <option value="tsukemen">ì¸ ì¼€ë©˜</option>
                        <option value="soba">ì†Œë°”</option>
                        <option value="udon">ìš°ë™</option>
                    </optgroup>
                    <optgroup label="ğŸ£ ì¼ì‹">
                        <option value="sushi">ìŠ¤ì‹œ</option>
                        <option value="sashimi_seafood">íšŒãƒ»í•´ì‚°ë¬¼ ìš”ë¦¬</option>
                        <option value="donburi">ëˆë¶€ë¦¬ (ë®ë°¥)</option>
                        <option value="tonkatsu">ëˆê¹ŒìŠ¤</option>
                        <option value="tempura">ë´í‘¸ë¼</option>
                        <option value="unagi">ì¥ì–´</option>
                        <option value="yakitori">ì•¼í‚¤í† ë¦¬</option>
                        <option value="sukiyaki_shabu">ìŠ¤í‚¤ì•¼í‚¤ãƒ»ìƒ¤ë¸Œìƒ¤ë¸Œ</option>
                        <option value="okonomiyaki_takoyaki">ì˜¤ì½”ë…¸ë¯¸ì•¼í‚¤ãƒ»íƒ€ì½”ì•¼í‚¤</option>
                        <option value="oden">ì˜¤ë…</option>
                        <option value="kaiseki">ê°€ì´ì„¸í‚¤ (ì½”ìŠ¤ ìš”ë¦¬)</option>
                    </optgroup>
                    <optgroup label="ğŸ¥© ê³ ê¸° ìš”ë¦¬">
                        <option value="yakiniku">ì•¼í‚¤ë‹ˆì¿ </option>
                        <option value="horumon">í˜¸ë¥´ëª¬</option>
                        <option value="steak_hamburg">ìŠ¤í…Œì´í¬ãƒ»í–„ë²„ê·¸</option>
                    </optgroup>
                    <optgroup label="ğŸ ì–‘ì‹">
                        <option value="pasta">íŒŒìŠ¤íƒ€</option>
                        <option value="pizza">í”¼ì</option>
                        <option value="french">í”„ë‘ìŠ¤ ìš”ë¦¬</option>
                        <option value="italian">ì´íƒˆë¦¬ì•„ ìš”ë¦¬</option>
                    </optgroup>
                    <optgroup label="ğŸŒ¶ï¸ ì•„ì‹œì•„ãƒ»ê¸°íƒ€">
                        <option value="curry">ì¹´ë ˆ</option>
                        <option value="chinese">ì¤‘í™”ìš”ë¦¬</option>
                        <option value="korean">í•œêµ­ ìš”ë¦¬</option>
                        <option value="ethnic">ì•„ì‹œì•„ãƒ»ì—ìŠ¤ë‹‰</option>
                    </optgroup>
                    <optgroup label="ğŸ» ìˆ ì§‘">
                         <option value="izakaya">ì´ìì¹´ì•¼</option>
                         <option value="bar">ë°”ãƒ»ë‹¤ì´ë‹ ë°”</option>
                    </optgroup>
                    <optgroup label="â˜•ï¸ ì¹´í˜ãƒ»ë””ì €íŠ¸">
                        <option value="cafe">ì¹´í˜</option>
                        <option value="sweets">ë””ì €íŠ¸ãƒ»ìŠ¤ìœ„ì¸ </option>
                        <option value="bread">ë¹µ</option>
                    </optgroup>
                </select>
            </div>
            <div>
                <label for="search-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">2. ë§›ì§‘ ê²€ìƒ‰</label>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="search-input" placeholder="ë„ì‹œ ë˜ëŠ” ê°€ê²Œ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰ (ì˜ˆ: ë„ì¿„)" class="flex-grow px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 transition bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-50 placeholder-gray-400 dark:placeholder-gray-500">
                    <button id="search-btn" class="px-4 py-2 bg-red-500 text-white font-semibold rounded-md hover:bg-red-600 transition flex-shrink-0 flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </button>
                </div>
            </div>
        </div>

        <main id="region-selection">
            <h2 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-4 text-center">ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”</h2>
            <div class="grid grid-cols-12 gap-2 sm:gap-4 max-w-2xl mx-auto">
                <div class="col-start-5 col-span-4 region-card p-4 sm:p-6 rounded-xl shadow-md text-center font-bold text-lg sm:text-xl cursor-pointer transition-all duration-300 bg-white dark:bg-gray-700 hover:shadow-lg hover:scale-105 hover:bg-red-500 hover:text-white dark:hover:text-white" data-region-key="hokkaido">ì‚¿í¬ë¡œ<br>(í™‹ì¹´ì´ë„)</div>
                <div class="col-start-6 col-span-4 region-card p-4 sm:p-6 rounded-xl shadow-md text-center font-bold text-lg sm:text-xl cursor-pointer transition-all duration-300 bg-white dark:bg-gray-700 hover:shadow-lg hover:scale-105 hover:bg-red-500 hover:text-white dark:hover:text-white" data-region-key="tohoku">ì„¼ë‹¤ì´<br>(ë„í˜¸ì¿ )</div>
                <div class="col-start-3 col-span-4 region-card p-4 sm:p-6 rounded-xl shadow-md text-center font-bold text-lg sm:text-xl cursor-pointer transition-all duration-300 bg-white dark:bg-gray-700 hover:shadow-lg hover:scale-105 hover:bg-red-500 hover:text-white dark:hover:text-white" data-region-key="chubu">ë‚˜ê³ ì•¼<br>(ì£¼ë¶€)</div>
                <div class="col-start-7 col-span-4 region-card p-4 sm:p-6 rounded-xl shadow-md text-center font-bold text-lg sm:text-xl cursor-pointer transition-all duration-300 bg-white dark:bg-gray-700 hover:shadow-lg hover:scale-105 hover:bg-red-500 hover:text-white dark:hover:text-white" data-region-key="kanto">ë„ì¿„<br>(ê°„í† )</div>
                <div class="col-start-2 col-span-4 region-card p-4 sm:p-6 rounded-xl shadow-md text-center font-bold text-lg sm:text-xl cursor-pointer transition-all duration-300 bg-white dark:bg-gray-700 hover:shadow-lg hover:scale-105 hover:bg-red-500 hover:text-white dark:hover:text-white" data-region-key="chugoku">íˆë¡œì‹œë§ˆ<br>(ì£¼ê³ ì¿ )</div>
                <div class="col-start-6 col-span-4 region-card p-4 sm:p-6 rounded-xl shadow-md text-center font-bold text-lg sm:text-xl cursor-pointer transition-all duration-300 bg-white dark:bg-gray-700 hover:shadow-lg hover:scale-105 hover:bg-red-500 hover:text-white dark:hover:text-white" data-region-key="kansai">ì˜¤ì‚¬ì¹´<br>êµí† <br>(ê°„ì‚¬ì´)</div>
                <div class="col-start-4 col-span-4 region-card p-4 sm:p-6 rounded-xl shadow-md text-center font-bold text-lg sm:text-xl cursor-pointer transition-all duration-300 bg-white dark:bg-gray-700 hover:shadow-lg hover:scale-105 hover:bg-red-500 hover:text-white dark:hover:text-white" data-region-key="shikoku">ë§ˆì¸ ì•¼ë§ˆ<br>ë‹¤ì¹´ë§ˆì¸ <br>(ì‹œì½”ì¿ )</div>
                <div class="col-start-1 col-span-4 region-card p-4 sm:p-6 rounded-xl shadow-md text-center font-bold text-lg sm:text-xl cursor-pointer transition-all duration-300 bg-white dark:bg-gray-700 hover:shadow-lg hover:scale-105 hover:bg-red-500 hover:text-white dark:hover:text-white" data-region-key="kyushu">í›„ì¿ ì˜¤ì¹´<br>(ê·œìŠˆ)<br>ì˜¤í‚¤ë‚˜ì™€</div>
            </div>
        </main>
        
        <section id="shop-list-view" class="hidden"></section>
    </div>

    <div id="modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-[1000] hidden"></div>
    
    <div id="error-message" class="hidden fixed top-5 right-5 bg-red-600 text-white py-3 px-5 rounded-lg shadow-xl z-[2000]">
        <p><strong class="font-bold">ì˜¤ë¥˜:</strong> ë§›ì§‘ ë°ì´í„°(data.json)ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const themeToggleBtn = document.getElementById('theme-toggle');
            const sunIcon = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>`;
            const moonIcon = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>`;

            const updateIcon = () => {
                themeToggleBtn.innerHTML = document.documentElement.classList.contains('dark') ? sunIcon : moonIcon;
            };

            themeToggleBtn.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
                updateIcon();
            });

            updateIcon();

            let allShops = null;
            try {
                const response = await fetch('./data.json');
                if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`); }
                allShops = await response.json();
            } catch (error) {
                console.error("ë§›ì§‘ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
                document.getElementById('error-message').classList.remove('hidden');
                return;
            }

            const app = {
                elements: {
                    foodTypeSelect: document.getElementById('food-type-select'),
                    searchInput: document.getElementById('search-input'),
                    searchBtn: document.getElementById('search-btn'),
                    regionSelection: document.getElementById('region-selection'),
                    shopListView: document.getElementById('shop-list-view'),
                    modal: document.getElementById('modal'),
                },
                state: { 
                    currentShops: [], currentRegionKey: null, currentSearchTerm: null
                },
                regionKeyMap: {
                    hokkaido: 'í™‹ì¹´ì´ë„', tohoku: 'ë„í˜¸ì¿ ', kanto: 'ê°„í† ', chubu: 'ì£¼ë¶€',
                    kansai: 'ê°„ì‚¬ì´', chugoku: 'ì£¼ê³ ì¿ ', shikoku: 'ì‹œì½”ì¿ ', kyushu: 'ê·œìŠˆÂ·ì˜¤í‚¤ë‚˜ì™€'
                },
                foodTypeNameMap: {
                    'all': 'ì „ì²´', 'ramen': 'ë¼ë©˜', 'tsukemen': 'ì¸ ì¼€ë©˜', 'soba': 'ì†Œë°”', 'udon': 'ìš°ë™', 'sushi': 'ìŠ¤ì‹œ', 'sashimi_seafood': 'íšŒãƒ»í•´ì‚°ë¬¼ ìš”ë¦¬', 'donburi': 'ëˆë¶€ë¦¬ (ë®ë°¥)', 'tonkatsu': 'ëˆê¹ŒìŠ¤', 'tempura': 'ë´í‘¸ë¼', 'unagi': 'ì¥ì–´', 'yakitori': 'ì•¼í‚¤í† ë¦¬', 'sukiyaki_shabu': 'ìŠ¤í‚¤ì•¼í‚¤ãƒ»ìƒ¤ë¸Œìƒ¤ë¸Œ', 'okonomiyaki_takoyaki': 'ì˜¤ì½”ë…¸ë¯¸ì•¼í‚¤ãƒ»íƒ€ì½”ì•¼í‚¤', 'oden': 'ì˜¤ë…', 'kaiseki': 'ê°€ì´ì„¸í‚¤ (ì½”ìŠ¤ ìš”ë¦¬)', 'yakiniku': 'ì•¼í‚¤ë‹ˆì¿ ', 'horumon': 'í˜¸ë¥´ëª¬', 'steak_hamburg': 'ìŠ¤í…Œì´í¬ãƒ»í–„ë²„ê·¸', 'pasta': 'íŒŒìŠ¤íƒ€', 'pizza': 'í”¼ì', 'french': 'í”„ë‘ìŠ¤ ìš”ë¦¬', 'italian': 'ì´íƒˆë¦¬ì•„ ìš”ë¦¬', 'curry': 'ì¹´ë ˆ', 'chinese': 'ì¤‘í™”ìš”ë¦¬', 'korean': 'í•œêµ­ ìš”ë¦¬', 'ethnic': 'ì•„ì‹œì•„ãƒ»ì—ìŠ¤ë‹‰', 'izakaya': 'ì´ìì¹´ì•¼', 'bar': 'ë°”ãƒ»ë‹¤ì´ë‹ ë°”', 'cafe': 'ì¹´í˜', 'sweets': 'ë””ì €íŠ¸ãƒ»ìŠ¤ìœ„ì¸ ', 'bread': 'ë¹µ'
                },

                init() { this.addEventListeners(); },

                addEventListeners() {
                    document.querySelectorAll('.region-card').forEach(card => card.addEventListener('click', () => this.handleRegionSelect(card.dataset.regionKey)));
                    this.elements.searchBtn.addEventListener('click', () => this.handleSearch());
                    this.elements.searchInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') this.handleSearch(); });
                    this.elements.foodTypeSelect.addEventListener('change', () => {
                        if (!this.elements.regionSelection.classList.contains('hidden')) return;
                        if (this.state.currentSearchTerm !== null) this.handleSearch();
                        else if (this.state.currentRegionKey !== null) this.handleRegionSelect(this.state.currentRegionKey);
                    });
                    this.elements.modal.addEventListener('click', (e) => { if (e.target === this.elements.modal) this.closeModal(); });
                },
                
                // â–¼â–¼â–¼ ìˆ˜ì •ëœ ë¶€ë¶„: 'ì „ì²´' ë³´ê¸°ë¥¼ ìœ„í•œ ë¡œì§ ì¶”ê°€ â–¼â–¼â–¼
                getShops(foodType, filterFn) {
                    if (foodType === 'all') {
                        let allShopsInType = [];
                        for (const key in allShops) {
                            allShopsInType = allShopsInType.concat(allShops[key].filter(filterFn));
                        }
                        return allShopsInType;
                    } else {
                        return (allShops[foodType] || []).filter(filterFn);
                    }
                },

                handleRegionSelect(regionKey) {
                    this.state.currentRegionKey = regionKey; this.state.currentSearchTerm = null;
                    const foodType = this.elements.foodTypeSelect.value;
                    const shops = this.getShops(foodType, s => s.region === regionKey);
                    const titleFoodType = this.foodTypeNameMap[foodType] || 'ë§›ì§‘';
                    this.displayShopList(shops, `${this.regionKeyMap[regionKey]} ${titleFoodType} ëª©ë¡`);
                },

                handleSearch() {
                    const searchTerm = this.elements.searchInput.value.trim();
                    if (!searchTerm) return;
                    this.state.currentSearchTerm = searchTerm; this.state.currentRegionKey = null;
                    const foodType = this.elements.foodTypeSelect.value;
                    const lowerCaseSearchTerm = searchTerm.toLowerCase();
                    const shops = this.getShops(foodType, shop => 
                        Object.values(shop).some(val => String(val).toLowerCase().includes(lowerCaseSearchTerm))
                    );
                    const titleFoodType = this.foodTypeNameMap[foodType] || 'ë§›ì§‘';
                    this.displayShopList(shops, `'${searchTerm}' ${titleFoodType} ê²€ìƒ‰ ê²°ê³¼`);
                },
                // â–²â–²â–² ìˆ˜ì •ëœ ë¶€ë¶„ â–²â–²â–²
                
                displayShopList(shops, title) {
                    shops.sort((a, b) => b.score - a.score);
                    this.state.currentShops = shops;
                    const shopListHTML = shops.length === 0 
                        ? `<p class="text-center text-gray-500 dark:text-gray-400 p-4">ë§›ì§‘ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`
                        : shops.map((shop, i) => this.createShopItemHTML(shop, i + 1)).join('');
                    this.elements.shopListView.innerHTML = `
                        <div class="flex flex-wrap gap-2 justify-between items-center mb-4">
                            <h2 class="text-xl md:text-2xl font-bold text-gray-800 dark:text-gray-100">${title}</h2>
                            <button id="back-to-regions-btn" class="px-3 py-1.5 text-sm bg-gray-600 dark:bg-gray-700 text-white font-semibold rounded-md hover:bg-gray-700 dark:hover:bg-gray-600">ì´ˆê¸°í™”ë©´ìœ¼ë¡œ</button>
                        </div>
                        <div class="space-y-4 bg-white dark:bg-gray-800 p-4 rounded-xl shadow-md">${shopListHTML}</div>`;
                    this.elements.shopListView.querySelector('#back-to-regions-btn').addEventListener('click', () => this.showRegionSelection());
                    this.elements.shopListView.querySelectorAll('.shop-list-item').forEach((item, index) => item.addEventListener('click', () => this.openModal(this.state.currentShops[index], index + 1)));
                    this.elements.regionSelection.classList.add('hidden');
                    this.elements.shopListView.classList.remove('hidden');
                },

                showRegionSelection() {
                    this.elements.shopListView.classList.add('hidden');
                    this.elements.regionSelection.classList.remove('hidden');
                    this.elements.searchInput.value = '';
                    this.state.currentShops = []; this.state.currentRegionKey = null; this.state.currentSearchTerm = null;
                },

                createShopItemHTML(shop, rank) {
                    return `<div class="shop-list-item p-4 rounded-lg cursor-pointer transition-all border border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700"><div class="flex items-center gap-4"><div class="flex-shrink-0 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm">${rank}</div><div class="flex-grow"><h3 class="font-semibold text-gray-800 dark:text-gray-100">${shop.name}</h3><p class="text-sm text-gray-500 dark:text-gray-400">${shop.prefecture} ${shop.city}</p></div><div class="flex items-center text-sm font-bold text-yellow-500"><svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>${shop.score}</div></div></div>`;
                },

                openModal(shop, rank) {
                    const queryName = shop.name_jp || shop.name;
                    const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(queryName + ' ' + shop.address_jp)}`;
                    this.elements.modal.innerHTML = `
                        <div id="modal-content" class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto transform transition-all duration-300 scale-95 opacity-0 custom-scrollbar">
                            <div class="p-6">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-sm font-semibold text-red-500 mb-1">#${rank}ìœ„</p>
                                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">${shop.name}</h2>
                                        <p class="text-md text-gray-600 dark:text-gray-400">${shop.name_jp || ''}</p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">${shop.prefecture} ${shop.city}</p>
                                    </div>
                                    <button id="close-modal-btn" class="text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                    </button>
                                </div>
                                <div class="mt-4 border-t border-gray-200 dark:border-gray-700 pt-4">
                                    <div class="flex items-center space-x-4">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-yellow-500"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg></span>
                                            <p class="text-lg font-bold text-gray-800 dark:text-gray-100">${shop.score} <span class="text-sm font-normal text-gray-500 dark:text-gray-400">/ íƒ€ë² ë¡œê·¸</span></p>
                                        </div>
                                        ${shop.google_score ? `
                                        <div class="flex items-center space-x-2">
                                            <span class="text-blue-500"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg></span>
                                            <p class="text-lg font-bold text-gray-800 dark:text-gray-100">${shop.google_score} <span class="text-sm font-normal text-gray-500 dark:text-gray-400">/ êµ¬ê¸€</span></p>
                                        </div>` : ''}
                                    </div>
                                    <p class="mt-3 text-gray-700 dark:text-gray-300 leading-relaxed">${shop.description}</p>
                                    <div class="mt-4 border-t border-gray-200 dark:border-gray-700 pt-4">
                                        <h3 class="text-sm font-semibold text-gray-600 dark:text-gray-400">ì£¼ì†Œ (ì¼ë³¸ì–´)</h3>
                                        <p class="text-gray-800 dark:text-gray-200 mt-1">${shop.address_jp}</p>
                                        <a href="${googleMapsUrl}" target="_blank" rel="noopener noreferrer" class="block w-full text-center mt-4 px-4 py-2 bg-green-500 text-white font-semibold rounded-md hover:bg-green-600 transition">Google ì§€ë„ë¡œ ë³´ê¸°</a>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    this.elements.modal.classList.remove('hidden');
                    setTimeout(() => { this.elements.modal.querySelector('#modal-content').classList.remove('scale-95', 'opacity-0'); }, 10);
                    this.elements.modal.querySelector('#close-modal-btn').addEventListener('click', () => this.closeModal());
                },

                closeModal() {
                    const modalContent = this.elements.modal.querySelector('#modal-content');
                    if (!modalContent) return;
                    modalContent.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => { this.elements.modal.classList.add('hidden'); }, 300);
                },
            };
            
            app.init();
        });
    </script>
</body>
</html>
